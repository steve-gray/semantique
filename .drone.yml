pipeline:
    install_npm_packages:
        image: node:4
        environment:
            - NPM_CONFIG_LOGLEVEL=warn
        commands:
            - npm install
            - npm test

    docker_publishing:
        image: plugins/docker
        repo: eventualconsistency/semantique
        tag: onbuild
        when:
            event: push

    dogfood_versioning:
        image: eventualconsistency/semantique:onbuild
        commands:
            - git config --global user.name steve-gray
            - git config --global user.email steve@eventualconsistency.net
            - npm start
        when:
            branch: master
            event: push

    push_back_to_git:
        image: plugins/git-push
        branch: master
        remote: ssh://git@github.com:steve-gray/semantique.git
        when:
            branch: master
            event: push